(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{118:function(e,t,a){e.exports=a(251)},123:function(e,t,a){},127:function(e,t,a){},249:function(e,t,a){},251:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(28),o=a.n(r),s=(a(123),a(15)),c=a(16),l=a(23),u=a(22),d=a(24),h=a(35),p=a.n(h),f=(a(125),a(255)),m=(a(127),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={times:null,selected:0},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.data!=e.data){var t=this.getTimes();this.setState({times:t})}}},{key:"render",value:function(){var e=this;return this.state.times?i.a.createElement(f.a.Group,{inverted:!0,className:"select-button"},this.state.times.map(function(t,a){return i.a.createElement(f.a,{inverted:!0,size:"small",key:a,onClick:function(){return e.onSelect(a)},active:a===e.state.selected},t)}),":"):null}},{key:"onSelect",value:function(e){this.setState({selected:e}),this.props.onSelect(e)}},{key:"getTimes",value:function(){var e=this,t=["\u3059\u3079\u3066"];return this.props.data.tommorow.timeDefine.forEach(function(a){var n=e.pt(a);t.push(n)}),this.props.data.dayafter.timeDefine.forEach(function(e){t.push(new Date(e.datetime).getDate()+"\u65e5")}),t}},{key:"pt",value:function(e){var t=parseInt(e.duration.substr(2).replace("H","")),a=new Date(e.datetime),n=new Date(a.getTime()+3600*t*1e3).getHours()||24;return"".concat(a.getDate(),"\u65e5").concat(a.getHours(),"-").concat(n)}}]),t}(n.Component)),y=a(109),v=function(){function e(t,a){var n=this;Object(s.a)(this,e),this.map=t,this.onSelected=a,this.addSelectedLayer(),this.map.on("click","weather-info-pref",function(e){n.onClick(e)})}return Object(c.a)(e,[{key:"addSelectedLayer",value:function(){this._addSelectedLayer("pref"),this._addSelectedLayer("distlict")}},{key:"_addSelectedLayer",value:function(e){this.map.addLayer({id:e+"-line-selected",type:"line",source:"vt","source-layer":e,paint:{"line-color":"rgba(70, 171, 199, 0.8)","line-width":1},filter:["==","code","0"]})}},{key:"onClick",value:function(e){if(e.features){console.log(e.features[0].properties);var t=this.getCode(e.features[0].properties.code),a=t.code,n=t.name||e.features[0].properties.name;this.selectPref(a),this.onSelected(a,n)}}},{key:"select",value:function(e,t){var a=this;["pref","distlict","region"].forEach(function(n){var i=n===e?t:["0"];a.map.setFilter(n+"-line-selected",["in","code"].concat(Object(y.a)(i)))})}}]),e}(),b=function(){function e(t,a,n){var i=this;Object(s.a)(this,e),this.hover=function(e){var t=i.map.queryRenderedFeatures(e.point,{layers:[]});if(i.map.getCanvas().style.cursor=t.length?"crosshair":"",t.length){var a=i.getCode(t[0].properties.code);i.weatherInfo.prefs[a]}i.popup.remove()},this.map=t,this.data=a,this.map.addSource("vt",{type:"vector",minzoom:0,maxzoom:10,tiles:["https://weatherbox.github.io/warning-area-vt/v2/{z}/{x}/{y}.pbf"]}),this.map.addLayer({id:"pref-line",type:"line",source:"vt","source-layer":"pref",paint:{"line-color":"rgba(70, 70, 70, 0.4)"}}),this.renderAll(),this.selectedLayer=new v(t,n),this.popup=new p.a.Popup({closeButton:!1}),this.map.on("mousemove",this.hover)}return Object(c.a)(e,[{key:"selectDatetime",value:function(e){var t=this.data.tommorow.timeDefine.length;0===e?this.renderAll():e<=t?this.render1(e-1):this.render2(e-t-1)}},{key:"renderAll",value:function(){var e=[];for(var t in this.data.all){var a=this.data.all[t];a&&e.push([t,this.getColor(a)])}this.renderLayer(e)}},{key:"render1",value:function(e){var t=this.data.tommorow.areas,a=[];for(var n in t){var i=t[n].possibilityAll[e];i&&a.push([n,this.getColor(i)])}this.renderLayer(a)}},{key:"render2",value:function(e){var t=this.data.tommorow.areas,a=this.data.dayafter.areas,n=[];for(var i in t){var r=a[t[i].area.prefCode].possibilityAll[e];r&&n.push([i,this.getColor(r)])}this.renderLayer(n)}},{key:"renderLayer",value:function(e){var t=e.length?{property:"code",type:"categorical",stops:e,default:"rgba(0, 0, 0, 0)"}:null;this.added?this.map.setPaintProperty("possibility","fill-color",t):(this.map.addLayer({id:"possibility",type:"fill",source:"vt","source-layer":"distlict",paint:{"fill-color":t,"fill-outline-color":"rgba(55, 55, 55, 0.4)"}},"pref-line"),this.added=!0)}},{key:"getColor",value:function(e){return{"\u9ad8":"rgba(253, 108, 112, 0.5)","\u4e2d":"rgba(253, 188, 172, 0.4)"}[e]}}]),e}(),g=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={data:null},a.onSelectDatetime=function(e){a.layer.selectDatetime(e)},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.loadWeatherInfo()}},{key:"onload",value:function(e){this.map=e,this.addLayer()}},{key:"loadWeatherInfo",value:function(){var e=this,t=(new Date).getTime();fetch("https://storage.googleapis.com/weather-warning/possibility.json?"+t,{mode:"cors"}).then(function(e){return e.json()}).then(function(t){console.log(t),e.setState({data:t}),e.data=t,e.addLayer()})}},{key:"addLayer",value:function(){this.map&&this.data&&(this.layer=new b(this.map,this.data,this.onSelected))}},{key:"render",value:function(){return i.a.createElement(m,{data:this.state.data,onSelect:this.onSelectDatetime})}}]),t}(n.Component);a(249);p.a.accessToken="pk.eyJ1IjoidGF0dGlpIiwiYSI6ImNqZWZ4eWM3NTI2cGszM2xpYXEyZndpd3IifQ.ifzbR45HecVGxChbdR2hiw";var k=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.map=new p.a.Map({container:this.mapContainer,style:"mapbox://styles/tattii/cj1bob6hw003t2rr5s2svi3iq",zoom:4.2,center:[146.6,35.5],hash:!0,attributionControl:!1}),this.map.on("load",function(){e.child.onload(e.map)})}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"app"},i.a.createElement("div",{ref:function(t){return e.mapContainer=t},id:"map"}),i.a.createElement(g,{ref:function(t){return e.child=t}}))}}]),t}(n.Component),w=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return i.a.createElement(k,null)}}]),t}(n.Component);o.a.render(i.a.createElement(w,null),document.getElementById("app"))}},[[118,2,1]]]);
//# sourceMappingURL=main.934ae083.chunk.js.map
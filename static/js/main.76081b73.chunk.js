(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{164:function(e,t,a){e.exports=a(314)},169:function(e,t,a){},173:function(e,t,a){},281:function(e,t,a){},310:function(e,t,a){},312:function(e,t,a){},314:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a.n(n),i=a(44),o=a.n(i),s=(a(169),a(14)),l=a(15),c=a(22),u=a(21),d=a(23),h=a(30),p=a.n(h),y=(a(171),a(154)),m=function(){function e(t,a){var n=this;Object(s.a)(this,e),this.map=t,this.onSelected=a,this.addSelectedLayer(),this.map.on("click","weather-info-pref",function(e){n.onClick(e)})}return Object(l.a)(e,[{key:"addSelectedLayer",value:function(){this._addSelectedLayer("pref"),this._addSelectedLayer("distlict")}},{key:"_addSelectedLayer",value:function(e){this.map.addLayer({id:e+"-line-selected",type:"line",source:"vt","source-layer":e,paint:{"line-color":"rgba(70, 171, 199, 0.8)","line-width":1},filter:["==","code","0"]})}},{key:"onClick",value:function(e){if(e.features){console.log(e.features[0].properties);var t=this.getCode(e.features[0].properties.code),a=t.code,n=t.name||e.features[0].properties.name;this.selectPref(a),this.onSelected(a,n)}}},{key:"select",value:function(e,t){var a=this;["pref","distlict","region"].forEach(function(n){var r=n===e?t:["0"];a.map.setFilter(n+"-line-selected",["in","code"].concat(Object(y.a)(r)))})}}]),e}(),f=function e(t){Object(s.a)(this,e),this.map=t,this.map.addSource("vt",{type:"vector",minzoom:0,maxzoom:10,tiles:["https://weatherbox.github.io/warning-area-vt/v2/{z}/{x}/{y}.pbf"]}),this.map.addLayer({id:"pref-line",type:"line",source:"vt","source-layer":"pref",paint:{"line-color":"rgba(70, 70, 70, 0.4)"}}),this.selectedLayer=new m(this.map)},v={none:"rgba(0, 0, 0, 0)",advisory:"rgba(248, 220, 37, 0.56)",warning:"rgba(246, 19, 19, 0.58)",emergency:"rgba(105, 66, 179, 0.6)"},g=function(){function e(t,a,n){var r=this;Object(s.a)(this,e),this.hover=function(e){var t,a=r.map.queryRenderedFeatures(e.point,{layers:[r.layerId]});if(r.map.getCanvas().style.cursor=a.length?"crosshair":"",a.length){var n=a[0].properties.code,i=r.data.cities[n];i&&i.warnings.length&&(t=i.name+"&emsp;",t+=i.warnings.map(r.warningLabel).join(""))}t?r.popup.setLngLat(e.lngLat).setHTML(t).addTo(r.map):r.popup.remove()},this.map=t,this.data=a,this.onSelected=n,this.layerId="warning",this.addMap()}return Object(l.a)(e,[{key:"addMap",value:function(){this.render(),this.popup=new p.a.Popup({closeButton:!1}),this.map.on("mousemove",this.hover)}},{key:"remove",value:function(){this.map.removeLayer(this.layerId),this.map.off("mousemove",this.hover),this.popup.remove()}},{key:"render",value:function(){var e=[];for(var t in this.data.cities){var a=this.data.cities[t];e.push([t,v[a.status]])}this.renderLayer(e)}},{key:"renderLayer",value:function(e){var t=e.length?{property:"code",type:"categorical",stops:e,default:"rgba(0, 0, 0, 0)"}:"rgba(0, 0, 0, 0)";this.added?this.map.setPaintProperty(this.layerId,"fill-color",t):(this.map.addLayer({id:this.layerId,type:"fill",source:"vt","source-layer":"city",paint:{"fill-color":t,"fill-outline-color":"rgba(55, 55, 55, 0.4)"}},"pref-line"),this.added=!0)}},{key:"warningLabel",value:function(e){return"\u6ce8\u610f\u5831"===e.substr(-3)?'<a class="ui label advisory">'+e.slice(0,-3)+"</a>":"\u7279\u5225\u8b66\u5831"===e.substr(-4)?'<a class="ui label emergency">'+e.slice(0,-4)+"</a>":"\u8b66\u5831"===e.substr(-2)?'<a class="ui label warning">'+e.slice(0,-2)+"</a>":void 0}}]),e}(),b=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={data:null},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.map=this.props.map,this.load()}},{key:"componentWillUnmount",value:function(){this.layer.remove()}},{key:"onload",value:function(e){this.map=e,this.addLayer()}},{key:"load",value:function(){var e=this,t=(new Date).getTime();fetch("https://storage.googleapis.com/weather-warning/warning.json?"+t,{mode:"cors"}).then(function(e){return e.json()}).then(function(t){console.log(t),e.setState({data:t}),e.data=t,e.addLayer()})}},{key:"addLayer",value:function(){this.map&&this.data&&(this.layer=new g(this.map,this.data,this.onSelected))}},{key:"render",value:function(){return null}}]),t}(n.Component),k=a(322),w=(a(173),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={times:null,selected:0},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){if(this.props.data!==e.data){var t=this.getTimes();this.setState({times:t})}}},{key:"render",value:function(){var e=this;return this.state.times?r.a.createElement(k.a.Group,{inverted:!0,className:"select-button"},this.state.times.map(function(t,a){return r.a.createElement(k.a,{inverted:!0,size:"small",key:a,onClick:function(){return e.onSelect(a)},active:a===e.state.selected},t)}),":"):null}},{key:"onSelect",value:function(e){this.setState({selected:e}),this.props.onSelect(e)}},{key:"getTimes",value:function(){var e=this,t=["\u3059\u3079\u3066"];return this.props.data.tommorow.timeDefine.forEach(function(a){var n=e.pt(a);t.push(n)}),this.props.data.dayafter.timeDefine.forEach(function(e){t.push(new Date(e.datetime).getDate()+"\u65e5")}),t}},{key:"pt",value:function(e){var t=parseInt(e.duration.substr(2).replace("H","")),a=new Date(e.datetime),n=new Date(a.getTime()+3600*t*1e3).getHours()||24;return"".concat(a.getDate(),"\u65e5").concat(a.getHours(),"-").concat(n)}}]),t}(n.Component)),j=a(321),O=a(320),L=(a(281),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={value:"all"},a.handleChange=function(e,t){var n=t.value;a.setState({value:n}),a.props.onSelect(n)},a.types=[{key:0,text:"\u3059\u3079\u3066",value:"all"},{key:1,text:"\u5927\u96e8",value:"rain"},{key:2,text:"\u66b4\u98a8",value:"wind"},{key:3,text:"\u6ce2\u6d6a",value:"wave"},{key:4,text:"\u5927\u96ea",value:"snow"}],a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(j.a,{compact:!0,inverted:!0,className:"type-dropdown"},r.a.createElement(O.a,{options:this.types,value:this.state.value,onChange:this.handleChange,item:!0}))}}]),t}(n.Component)),S={all:"all",rain:"\u96e8",snow:"\u96ea",wind:"\u98a8\uff08\u98a8\u96ea\uff09",wave:"\u6ce2"},C=function(){function e(t,a,n){var r=this;Object(s.a)(this,e),this.hover=function(e){var t,a=r.map.queryRenderedFeatures(e.point,{layers:[r.layerId]});if(r.map.getCanvas().style.cursor=a.length?"crosshair":"",a.length){var n=a[0].properties.code,i=r.data.tommorow.areas[n];i&&(t=i.text)}t?r.popup.setLngLat(e.lngLat).setHTML(t).addTo(r.map):r.popup.remove()},this.map=t,this.data=a,this.selected={index:0,type:"all"},this.layerId="possibility",this.renderAll(),this.popup=new p.a.Popup({closeButton:!1}),this.map.on("mousemove",this.hover)}return Object(l.a)(e,[{key:"remove",value:function(){this.map.removeLayer(this.layerId),this.map.off("mousemove",this.hover),this.popup.remove()}},{key:"selectDatetime",value:function(e){this.selected.index=e,this.render()}},{key:"selectType",value:function(e){this.selected.type=S[e],this.render()}},{key:"render",value:function(){var e=this.selected,t=e.index,a=e.type,n=this.data.tommorow.timeDefine.length;0===t?this.renderAll(a):t<=n?this.render1(a,t-1):this.render2(a,t-n-1)}},{key:"renderAll",value:function(e){if(e&&"all"!==e)return this.renderAllType(e);var t=[];for(var a in this.data.all){var n=this.data.all[a];n&&t.push([a,this.getColor(n)])}this.renderLayer(t)}},{key:"render1",value:function(e,t){var a=this.data.tommorow.areas,n=[];for(var r in a){var i=this.getRank(a[r],e,t);i&&n.push([r,this.getColor(i)])}this.renderLayer(n)}},{key:"render2",value:function(e,t){var a=this.data.tommorow.areas,n=this.data.dayafter.areas,r=[];for(var i in a){var o=a[i].area.prefCode,s=this.getRank(n[o],e,t);s&&r.push([i,this.getColor(s)])}this.renderLayer(r)}},{key:"renderAllType",value:function(e){var t=this.data.tommorow.areas,a=this.data.dayafter.areas,n=[];for(var r in t){var i=t[r].area.prefCode,o=t[r].possibility.find(function(t){return t.type===e})||{},s=a[i].possibility.find(function(t){return t.type===e})||{},l=this.getMaxRank([].concat(o.rank,s.rank));l&&n.push([r,this.getColor(l)])}this.renderLayer(n)}},{key:"getRank",value:function(e,t,a){if("all"===t)return e.possibilityAll[a];var n=e.possibility.find(function(e){return e.type===t});return n?n.rank[a]:void 0}},{key:"renderLayer",value:function(e){var t=e.length?{property:"code",type:"categorical",stops:e,default:"rgba(0, 0, 0, 0)"}:"rgba(0, 0, 0, 0)";this.added?this.map.setPaintProperty(this.layerId,"fill-color",t):(this.map.addLayer({id:this.layerId,type:"fill",source:"vt","source-layer":"distlict",paint:{"fill-color":t,"fill-outline-color":"rgba(55, 55, 55, 0.4)"}},"pref-line"),this.added=!0)}},{key:"getColor",value:function(e){return{"\u9ad8":"rgba(253, 108, 112, 0.5)","\u4e2d":"rgba(253, 188, 172, 0.4)"}[e]}},{key:"getMaxRank",value:function(e){return e.includes("\u9ad8")?"\u9ad8":e.includes("\u4e2d")?"\u4e2d":null}}]),e}(),I=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={data:null},a.onSelectDatetime=function(e){a.layer.selectDatetime(e)},a.onSelectType=function(e){a.layer.selectType(e)},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.map=this.props.map,this.load()}},{key:"componentWillUnmount",value:function(){this.layer.remove()}},{key:"onload",value:function(e){this.map=e,this.addLayer()}},{key:"load",value:function(){var e=this,t=(new Date).getTime();fetch("https://storage.googleapis.com/weather-warning/possibility.json?"+t,{mode:"cors"}).then(function(e){return e.json()}).then(function(t){console.log(t),e.setState({data:t}),e.data=t,e.addLayer()})}},{key:"addLayer",value:function(){this.map&&this.data&&(this.layer=new C(this.map,this.data,this.onSelected))}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(w,{data:this.state.data,onSelect:this.onSelectDatetime}),r.a.createElement(L,{onSelect:this.onSelectType}))}}]),t}(n.Component),x=(a(310),a(136)),E=(a(312),function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={active:0},a.handleItemClick=function(e,t){var n=t.id,r=a.props.layers.findIndex(function(e){return e.id===n});a.setState({active:r}),a.props.onSelect(r)},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.setState({active:this.props.init})}},{key:"render",value:function(){var e=this,t=this.state.active;return r.a.createElement(j.a,{icon:!0,vertical:!0,inverted:!0,id:"layer-menu"},this.props.layers.map(function(a,n){return r.a.createElement(j.a.Item,{key:n,id:a.id,name:a.name,active:t===n,onClick:e.handleItemClick},r.a.createElement(x.a,{name:a.icon}))}))}}]),t}(n.Component));p.a.accessToken="pk.eyJ1IjoidGF0dGlpIiwiYSI6ImNqZWZ4eWM3NTI2cGszM2xpYXEyZndpd3IifQ.ifzbR45HecVGxChbdR2hiw";var D=[{id:"warning",component:b,name:"\u6c17\u8c61\u8b66\u5831\u30fb\u6ce8\u610f\u5831",icon:"warning sign"},{id:"possibility",component:I,name:"\u8b66\u5831\u7d1a\u306e\u53ef\u80fd\u6027",icon:"calendar alternate outline"}],T=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={layerIndex:1},a.selectLayer=function(e){a.setState({layerIndex:e})},a}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.map=new p.a.Map({container:this.mapContainer,style:"mapbox://styles/tattii/cj1bob6hw003t2rr5s2svi3iq",zoom:4.2,center:[146.6,35.5],hash:!0,attributionControl:!1}),this.map.on("load",function(){e.base=new f(e.map),e.child.onload(e.map)})}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"app"},r.a.createElement("div",{ref:function(t){return e.mapContainer=t},id:"map"}),this.renderLayer(),r.a.createElement(E,{layers:D,init:this.state.layerIndex,onSelect:this.selectLayer}))}},{key:"renderLayer",value:function(){var e=this,t={map:this.map,ref:function(t){return e.child=t}};return r.a.createElement(D[this.state.layerIndex].component,t)}}]),t}(n.Component),M=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(T,null)}}]),t}(n.Component);o.a.render(r.a.createElement(M,null),document.getElementById("app"))}},[[164,2,1]]]);
//# sourceMappingURL=main.76081b73.chunk.js.map
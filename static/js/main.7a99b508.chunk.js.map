{"version":3,"sources":["components/SelectButton.js","components/TypeDropdown.js","SelectedLayer.js","PossibilityLayer.js","Possibility.js","Map.js","App.js","index.js"],"names":["SelectButton","state","times","selected","prevProps","this","props","data","getTimes","setState","_this2","react_default","a","createElement","Button","Group","inverted","className","map","time","i","size","key","onClick","onSelect","active","_this3","tommorow","timeDefine","forEach","def","text","pt","push","dayafter","Date","datetime","getDate","hours","parseInt","duration","substr","replace","from","toH","getTime","getHours","concat","Component","TypeDropdown","value","handleChange","e","_ref","_this","types","Menu","compact","Dropdown","options","onChange","item","SelectedLayer","onSelected","Object","classCallCheck","addSelectedLayer","on","_addSelectedLayer","type","addLayer","id","source","source-layer","paint","line-color","line-width","filter","features","console","log","properties","_this$getCode","getCode","code","prefName","name","selectPref","codes","l","setFilter","toConsumableArray","all","rain","snow","wind","wave","PossibilityLayer","hover","html","queryRenderedFeatures","point","layers","getCanvas","style","cursor","length","info","areas","popup","setLngLat","lngLat","setHTML","addTo","remove","index","addSource","minzoom","maxzoom","tiles","renderAll","selectedLayer","mapboxgl","Popup","closeButton","render","_this$selected","length1","render1","render2","renderAllType","stops","rank","getColor","renderLayer","getRank","areas1","areas2","prefCode","area","p1","possibility","find","p","p2","getMaxRank","possibilityAll","undefined","fill","property","default","added","setPaintProperty","fill-color","fill-outline-color","高","中","ranks","includes","Possibility","onSelectDatetime","layer","selectDatetime","onSelectType","selectType","loadWeatherInfo","timestamp","fetch","url","mode","then","res","json","Fragment","SelectButton_SelectButton","TypeDropdown_TypeDropdown","accessToken","Map","container","mapContainer","zoom","center","hash","attributionControl","child","onload","ref","el","Possibility_Possibility","App","Map_Map","ReactDOM","src_App","document","getElementById"],"mappings":"wVAKqBA,qNACnBC,MAAQ,CAAEC,MAAO,KAAMC,SAAU,qFAEdC,GACjB,GAAIC,KAAKC,MAAMC,OAASH,EAAUG,KAAM,CACtC,IAAML,EAAQG,KAAKG,WACnBH,KAAKI,SAAS,CAAEP,4CAIX,IAAAQ,EAAAL,KACP,OAAKA,KAAKJ,MAAMC,MAEdS,EAAAC,EAAAC,cAACC,EAAA,EAAOC,MAAR,CAAcC,UAAQ,EAACC,UAAU,iBAC9BZ,KAAKJ,MAAMC,MAAMgB,IAAI,SAACC,EAAMC,GAAP,OACpBT,EAAAC,EAAAC,cAACC,EAAA,EAAD,CACEE,UAAQ,EAACK,KAAK,QACdC,IAAKF,EACLG,QAAS,kBAAMb,EAAKc,SAASJ,IAC7BK,OAAQL,IAAMV,EAAKT,MAAME,UAExBgB,KARP,KAF4B,sCAiBvBC,GACPf,KAAKI,SAAS,CAAEN,SAAUiB,IAC1Bf,KAAKC,MAAMkB,SAASJ,sCAGX,IAAAM,EAAArB,KACHH,EAAQ,CAAC,sBAWf,OATAG,KAAKC,MAAMC,KAAKoB,SAASC,WAAWC,QAAQ,SAAAC,GAC1C,IAAMC,EAAOL,EAAKM,GAAGF,GACrB5B,EAAM+B,KAAKF,KAGb1B,KAAKC,MAAMC,KAAK2B,SAASN,WAAWC,QAAQ,SAAAC,GAC1C5B,EAAM+B,KAAK,IAAIE,KAAKL,EAAIM,UAAUC,UAAY,YAGzCnC,6BAGN4B,GACD,IAAMQ,EAAQC,SAAST,EAAIU,SAASC,OAAO,GAAGC,QAAQ,IAAK,KACrDC,EAAO,IAAIR,KAAKL,EAAIM,UAEpBQ,EADK,IAAIT,KAAKQ,EAAKE,UAAoB,KAARP,EAAe,KACrCQ,YAAc,GAC7B,SAAAC,OAAUJ,EAAKN,UAAf,UAAAU,OAA4BJ,EAAKG,WAAjC,KAAAC,OAA+CH,UArDTI,gCCArBC,qNACnBhD,MAAQ,CAAEiD,MAAO,SAEjBC,aAAe,SAACC,EAADC,GAAkB,IAAZH,EAAYG,EAAZH,MACnBI,EAAK7C,SAAS,CAAEyC,UAChBI,EAAKhD,MAAMkB,SAAS0B,MAGtBK,MAAQ,CACN,CAAEjC,IAAK,EAAGS,KAAM,qBAAOmB,MAAO,OAC9B,CAAE5B,IAAK,EAAGS,KAAM,eAAMmB,MAAO,QAC7B,CAAE5B,IAAK,EAAGS,KAAM,eAAMmB,MAAO,QAC7B,CAAE5B,IAAK,EAAGS,KAAM,eAAMmB,MAAO,QAC7B,CAAE5B,IAAK,EAAGS,KAAM,eAAMmB,MAAO,iFAI7B,OACEvC,EAAAC,EAAAC,cAAC2C,EAAA,EAAD,CAAMC,SAAO,EAACzC,UAAQ,EAACC,UAAU,iBAC/BN,EAAAC,EAAAC,cAAC6C,EAAA,EAAD,CACEC,QAAStD,KAAKkD,MACdL,MAAO7C,KAAKJ,MAAMiD,MAClBU,SAAUvD,KAAK8C,aACfU,MAAI,YAvB4Bb,uBCLrBc,aACnB,SAAAA,EAAY5C,EAAK6C,GAAY,IAAAT,EAAAjD,KAAA2D,OAAAC,EAAA,EAAAD,CAAA3D,KAAAyD,GAC3BzD,KAAKa,IAAMA,EACXb,KAAK0D,WAAaA,EAElB1D,KAAK6D,mBACL7D,KAAKa,IAAIiD,GAAG,QAAS,oBAAqB,SAACf,GACzCE,EAAK/B,QAAQ6B,oEAKf/C,KAAK+D,kBAAkB,QACvB/D,KAAK+D,kBAAkB,sDAGPC,GAChBhE,KAAKa,IAAIoD,SAAS,CAChBC,GAAMF,EAAO,iBACbA,KAAQ,OACRG,OAAU,KACVC,eAAgBJ,EAChBK,MAAS,CACPC,aAAc,0BACdC,aAAc,GAEhBC,OAAQ,CAAC,KAAM,OAAQ,uCAInBzB,GACN,GAAIA,EAAE0B,SAAU,CACdC,QAAQC,IAAI5B,EAAE0B,SAAS,GAAGG,YADZ,IAAAC,EAES7E,KAAK8E,QAAQ/B,EAAE0B,SAAS,GAAGG,WAAWG,MAArDA,EAFMF,EAENE,KACFC,EAHQH,EAEAI,MACWlC,EAAE0B,SAAS,GAAGG,WAAWK,KAClDjF,KAAKkF,WAAWH,GAChB/E,KAAK0D,WAAWqB,EAAMC,mCAInBhB,EAAMmB,GAAO,IAAA9E,EAAAL,KAClB,CAAC,OAAQ,WAAY,UAAUwB,QAAQ,SAAA4D,GACrC,IAAMZ,EAASY,IAAMpB,EAAOmB,EAAQ,CAAC,KACrC9E,EAAKQ,IAAIwE,UAAUD,EAAI,iBAAvB,CAA0C,KAAM,QAAhD1C,OAAAiB,OAAA2B,EAAA,EAAA3B,CAA2Da,gBCxC3DtB,EAAQ,CACZqC,IAAK,MACLC,KAAM,SACNC,KAAM,SACNC,KAAM,iCACNC,KAAM,UAIaC,aACnB,SAAAA,EAAY/E,EAAKX,EAAMwD,GAAY,IAAAT,EAAAjD,KAAA2D,OAAAC,EAAA,EAAAD,CAAA3D,KAAA4F,GAAA5F,KAoKnC6F,MAAQ,SAAC9C,GACP,IAGI+C,EAHErB,EAAWxB,EAAKpC,IAAIkF,sBAAsBhD,EAAEiD,MAAO,CAAEC,OAAQ,CAAC,iBAIpE,GAHAhD,EAAKpC,IAAIqF,YAAYC,MAAMC,OAAU3B,EAAS4B,OAAU,YAAc,GAGlE5B,EAAS4B,OAAQ,CACnB3B,QAAQC,IAAIF,EAAS,IACrB,IAAMM,EAAON,EAAS,GAAGG,WAAWG,KAC9BuB,EAAOrD,EAAK/C,KAAKoB,SAASiF,MAAMxB,GAClCuB,IACFR,EAAOQ,EAAK5E,MAIZoE,EACF7C,EAAKuD,MAAMC,UAAU1D,EAAE2D,QACpBC,QAAQb,GACRc,MAAM3D,EAAKpC,KAEdoC,EAAKuD,MAAMK,UAtLb7G,KAAKa,IAAMA,EACXb,KAAKE,KAAOA,EAEZF,KAAKF,SAAW,CACdgH,MAAO,EACP9C,KAAM,OAGRhE,KAAKa,IAAIkG,UAAU,KAAM,CACvB/C,KAAQ,SACRgD,QAAW,EACXC,QAAW,GACXC,MAAS,CAAC,qEAGZlH,KAAKa,IAAIoD,SAAS,CAChBC,GAAM,YACNF,KAAQ,OACRG,OAAU,KACVC,eAAgB,OAChBC,MAAS,CACPC,aAAc,2BAGlBtE,KAAKmH,YACLnH,KAAKoH,cAAiB,IAAI3D,EAAc5C,EAAK6C,GAE7C1D,KAAKwG,MAAQ,IAAIa,IAASC,MAAM,CAC9BC,aAAa,IAEfvH,KAAKa,IAAIiD,GAAG,YAAa9D,KAAK6F,kEAMjBiB,GACb9G,KAAKF,SAASgH,MAAQA,EACtB9G,KAAKwH,4CAGIxD,GACThE,KAAKF,SAASkE,KAAOd,EAAMc,GAC3BhE,KAAKwH,0CAKE,IAAAC,EACiBzH,KAAKF,SAArBgH,EADDW,EACCX,MAAO9C,EADRyD,EACQzD,KACT0D,EAAU1H,KAAKE,KAAKoB,SAASC,WAAW8E,OAChC,IAAVS,EACF9G,KAAKmH,UAAUnD,GAEN8C,GAASY,EAClB1H,KAAK2H,QAAQ3D,EAAM8C,EAAQ,GAE3B9G,KAAK4H,QAAQ5D,EAAM8C,EAAQY,EAAU,qCAI/B1D,GACR,GAAIA,GAAiB,QAATA,EAAgB,OAAOhE,KAAK6H,cAAc7D,GACtD,IAAM8D,EAAQ,GAEd,IAAK,IAAI/C,KAAQ/E,KAAKE,KAAKqF,IAAK,CAC9B,IAAMwC,EAAO/H,KAAKE,KAAKqF,IAAIR,GACvBgD,GAAMD,EAAMlG,KAAK,CAACmD,EAAM/E,KAAKgI,SAASD,KAE5C/H,KAAKiI,YAAYH,mCAGX9D,EAAM8C,GACZ,IAAMP,EAAQvG,KAAKE,KAAKoB,SAASiF,MAC3BuB,EAAQ,GAEd,IAAK,IAAI/C,KAAQwB,EAAO,CACtB,IAAMwB,EAAO/H,KAAKkI,QAAQ3B,EAAMxB,GAAOf,EAAM8C,GAC7CpC,QAAQC,IAAIoD,GACRA,GAAMD,EAAMlG,KAAK,CAACmD,EAAM/E,KAAKgI,SAASD,KAE5C/H,KAAKiI,YAAYH,mCAGX9D,EAAM8C,GACZ,IAAMqB,EAASnI,KAAKE,KAAKoB,SAASiF,MAC5B6B,EAASpI,KAAKE,KAAK2B,SAAS0E,MAC5BuB,EAAQ,GAEd,IAAK,IAAI/C,KAAQoD,EAAQ,CACvB,IAAME,EAAWF,EAAOpD,GAAMuD,KAAKD,SAC7BN,EAAO/H,KAAKkI,QAAQE,EAAOC,GAAWrE,EAAM8C,GAC9CiB,GAAMD,EAAMlG,KAAK,CAACmD,EAAM/E,KAAKgI,SAASD,KAE5C/H,KAAKiI,YAAYH,yCAGL9D,GACZ,IAAMmE,EAASnI,KAAKE,KAAKoB,SAASiF,MAC5B6B,EAASpI,KAAKE,KAAK2B,SAAS0E,MAC5BuB,EAAQ,GAEd,IAAK,IAAI/C,KAAQoD,EAAQ,CACvB,IAAME,EAAWF,EAAOpD,GAAMuD,KAAKD,SAC7BE,EAAKJ,EAAOpD,GAAMyD,YAAYC,KAAK,SAAAC,GAAC,OAAIA,EAAE1E,OAASA,KAAS,GAC5D2E,EAAKP,EAAOC,GAAUG,YAAYC,KAAK,SAAAC,GAAC,OAAIA,EAAE1E,OAASA,KAAS,GAChE+D,EAAO/H,KAAK4I,WAAW,GAAGlG,OAAO6F,EAAGR,KAAMY,EAAGZ,OAC/CA,GAAMD,EAAMlG,KAAK,CAACmD,EAAM/E,KAAKgI,SAASD,KAE5C/H,KAAKiI,YAAYH,mCAIXQ,EAAMtE,EAAM8C,GAClB,GAAa,QAAT9C,EACF,OAAOsE,EAAKO,eAAe/B,GAG3B,IAAM4B,EAAIJ,EAAKE,YAAYC,KAAK,SAAAC,GAAC,OAAIA,EAAE1E,OAASA,IAChD,OAAO0E,EAAIA,EAAEX,KAAKjB,QAASgC,sCAInBhB,GACV,IAAMiB,EAAOjB,EAAMzB,OAAS,CAC1B2C,SAAY,OACZhF,KAAQ,cACR8D,MAASA,EACTmB,QAAW,oBACT,mBAECjJ,KAAKkJ,MAaRlJ,KAAKa,IAAIsI,iBAAiB,cAAe,aAAcJ,IAZvD/I,KAAKa,IAAIoD,SAAS,CAChBC,GAAM,cACNF,KAAQ,OACRG,OAAU,KACVC,eAAgB,WAChBC,MAAS,CACP+E,aAAcL,EACdM,qBAAsB,0BAEvB,aACHrJ,KAAKkJ,OAAQ,oCAORnB,GAKP,MAJe,CACbuB,SAAK,2BACLC,SAAM,4BAEMxB,sCAGLyB,GACT,OAAIA,EAAMC,SAAS,UAAa,SAC5BD,EAAMC,SAAS,UAAa,SACzB,cCrKUC,6MACnB9J,MAAQ,CACNM,KAAM,QA+CRyJ,iBAAmB,SAAC7C,GAClB7D,EAAK2G,MAAMC,eAAe/C,MAG5BgD,aAAe,SAAC9F,GACdf,EAAK2G,MAAMG,WAAW/F,uFAhDtBhE,KAAKgK,iDAGAnJ,GACLb,KAAKa,IAAMA,EACXb,KAAKiE,qDAGW,IAAA5D,EAAAL,KACViK,GAAY,IAAInI,MAAOU,UAC7B0H,MAAMC,mEAAYF,EAAW,CAACG,KAAM,SACjCC,KAAK,SAAAC,GAAG,OAAIA,EAAIC,SAChBF,KAAK,SAAAnK,GACJwE,QAAQC,IAAIzE,GACZG,EAAKD,SAAS,CAAEF,SAChBG,EAAKH,KAAOA,EACZG,EAAK4D,gDAKJjE,KAAKa,KAAQb,KAAKE,OACvBF,KAAK4J,MAAQ,IAAIhE,EAAiB5F,KAAKa,IAAKb,KAAKE,KAAMF,KAAK0D,8CAI5D,OAAOpD,EAAAC,EAAAC,cAAAF,EAAAC,EAAAiK,SAAA,KACLlK,EAAAC,EAAAC,cAACiK,EAAD,CACEvK,KAAMF,KAAKJ,MAAMM,KACjBiB,SAAUnB,KAAK2J,mBACjBrJ,EAAAC,EAAAC,cAACkK,EAAD,CACEvJ,SAAUnB,KAAK8J,uBArCkBnH,oBCDzC0E,IAASsD,YAAc,+FAGFC,8LACC,IAAA3H,EAAAjD,KAClBA,KAAKa,IAAM,IAAIwG,IAASuD,IAAI,CAC1BC,UAAW7K,KAAK8K,aAChB3E,MAAO,mDACP4E,KAAM,IACNC,OAAQ,CAAC,MAAY,MACrBC,MAAM,EACNC,oBAAoB,IAGtBlL,KAAKa,IAAIiD,GAAG,OAAQ,WAClBb,EAAKkI,MAAMC,OAAOnI,EAAKpC,wCAIlB,IAAAR,EAAAL,KACP,OACEM,EAAAC,EAAAC,cAAA,OAAKI,UAAU,OACbN,EAAAC,EAAAC,cAAA,OAAK6K,IAAK,SAAAC,GAAE,OAAIjL,EAAKyK,aAAeQ,GAAIpH,GAAG,QAC3C5D,EAAAC,EAAAC,cAAC+K,EAAD,CACEF,IAAK,SAAAA,GAAG,OAAIhL,EAAK8K,MAAQE,aArBF1I,aCClB6I,mLANX,OACElL,EAAAC,EAAAC,cAACiL,EAAD,aAHY9I,aCClB+I,IAASlE,OAAOlH,EAAAC,EAAAC,cAACmL,EAAD,MAASC,SAASC,eAAe","file":"static/js/main.7a99b508.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { Button } from 'semantic-ui-react';\n\nimport './SelectButton.css';\n\nexport default class SelectButton extends Component {\n  state = { times: null, selected: 0 };\n\n  componentDidUpdate(prevProps) {\n    if (this.props.data !== prevProps.data) {\n      const times = this.getTimes();\n      this.setState({ times });\n    }\n  }\n\n  render() {\n    if (!this.state.times) return null;\n    return (\n      <Button.Group inverted className=\"select-button\">\n        {this.state.times.map((time, i) => (\n          <Button\n            inverted size=\"small\"\n            key={i}\n            onClick={() => this.onSelect(i)}\n            active={i === this.state.selected}\n          >\n            {time}\n          </Button>\n        ))}:\n      </Button.Group>\n    );\n  }\n\n  onSelect(i) {\n    this.setState({ selected: i });\n    this.props.onSelect(i);\n  }\n\n  getTimes() {\n    const times = ['すべて'];\n\n    this.props.data.tommorow.timeDefine.forEach(def => {\n      const text = this.pt(def);\n      times.push(text);\n    });\n\n    this.props.data.dayafter.timeDefine.forEach(def => {\n      times.push(new Date(def.datetime).getDate() + '日');\n    });\n\n    return times;\n  }\n\n  pt(def) {\n    const hours = parseInt(def.duration.substr(2).replace('H', ''));\n    const from = new Date(def.datetime);\n    const to = new Date(from.getTime() + hours * 3600 * 1000);\n    const toH = to.getHours() || 24;\n    return `${from.getDate()}日${from.getHours()}-${toH}`;\n  }\n}\n","import React, { Component } from 'react';\nimport { Dropdown, Menu } from 'semantic-ui-react';\n\nimport './TypeDropdown.css';\n\nexport default class TypeDropdown extends Component {\n  state = { value: 'all' };\n\n  handleChange = (e, { value }) => {\n    this.setState({ value });\n    this.props.onSelect(value);\n  }\n\n  types = [\n    { key: 0, text: 'すべて', value: 'all' },\n    { key: 1, text: '大雨', value: 'rain' },\n    { key: 2, text: '暴風', value: 'wind' },\n    { key: 3, text: '波浪', value: 'wave' },\n    { key: 4, text: '大雪', value: 'snow' },\n  ];\n\n  render() {\n    return (\n      <Menu compact inverted className=\"type-dropdown\">\n        <Dropdown\n          options={this.types}\n          value={this.state.value}\n          onChange={this.handleChange}\n          item\n        />\n      </Menu>\n    );\n  }\n}\n","export default class SelectedLayer {\n  constructor(map, onSelected) {\n    this.map = map;\n    this.onSelected = onSelected;\n\n    this.addSelectedLayer();\n    this.map.on('click', 'weather-info-pref', (e) => {\n      this.onClick(e);\n    });\n  }\n\n  addSelectedLayer() {\n    this._addSelectedLayer('pref');\n    this._addSelectedLayer('distlict');\n  }\n  \n  _addSelectedLayer(type) {\n    this.map.addLayer({\n      \"id\": type + \"-line-selected\",\n      \"type\": \"line\",\n      \"source\": \"vt\",\n      \"source-layer\": type,\n      \"paint\": {\n        \"line-color\": \"rgba(70, 171, 199, 0.8)\",\n        \"line-width\": 1\n      },\n      filter: [\"==\", \"code\", \"0\"]\n    });\n  }\n\n  onClick(e) {\n    if (e.features) {\n      console.log(e.features[0].properties);\n      const { code, name } = this.getCode(e.features[0].properties.code);\n      const prefName = name || e.features[0].properties.name;\n      this.selectPref(code);\n      this.onSelected(code, prefName);\n    }\n  }\n  \n  select(type, codes) {\n    ['pref', 'distlict', 'region'].forEach(l => {\n      const filter = l === type ? codes : ['0'];\n      this.map.setFilter(l + '-line-selected', ['in', 'code', ...filter]);\n    });\n  }\n}\n","import mapboxgl from 'mapbox-gl';\nimport SelectedLayer from './SelectedLayer';\n\nconst types = {\n  all: 'all',\n  rain: '雨',\n  snow: '雪',\n  wind: '風（風雪）',\n  wave: '波',\n};\n\n\nexport default class PossibilityLayer {\n  constructor(map, data, onSelected) {\n    this.map = map;\n    this.data = data;\n\n    this.selected = {\n      index: 0,\n      type: 'all',\n    };\n\n    this.map.addSource(\"vt\", {\n      \"type\": \"vector\",\n      \"minzoom\": 0,\n      \"maxzoom\": 10,\n      \"tiles\": [\"https://weatherbox.github.io/warning-area-vt/v2/{z}/{x}/{y}.pbf\"]\n    });\n\n    this.map.addLayer({\n      \"id\": \"pref-line\",\n      \"type\": \"line\",\n      \"source\": \"vt\",\n      \"source-layer\": \"pref\",\n      \"paint\": {\n        \"line-color\": \"rgba(70, 70, 70, 0.4)\"\n      }\n    });\n    this.renderAll();\n    this.selectedLayer =  new SelectedLayer(map, onSelected);\n\n    this.popup = new mapboxgl.Popup({\n      closeButton: false\n    });\n    this.map.on('mousemove', this.hover);\n  }\n\n\n  // UI API\n\n  selectDatetime(index) {\n    this.selected.index = index;\n    this.render();\n  }\n\n  selectType(type) {\n    this.selected.type = types[type];\n    this.render();\n  }\n\n\n  // \n  render() {\n    const { index, type } = this.selected;\n    const length1 = this.data.tommorow.timeDefine.length;\n    if (index === 0) {\n      this.renderAll(type);\n\n    } else if (index <= length1) {\n      this.render1(type, index - 1);\n    } else {\n      this.render2(type, index - length1 - 1);\n    }\n  }\n\n  renderAll(type) {\n    if (type && type !== 'all') return this.renderAllType(type);\n    const stops = [];\n\n    for (let code in this.data.all) {\n      const rank = this.data.all[code];\n      if (rank) stops.push([code, this.getColor(rank)]);\n    }\n    this.renderLayer(stops);\n  }\n\n  render1(type, index) {\n    const areas = this.data.tommorow.areas;\n    const stops = [];\n\n    for (let code in areas) {\n      const rank = this.getRank(areas[code], type, index);\n      console.log(rank);\n      if (rank) stops.push([code, this.getColor(rank)]);\n    }\n    this.renderLayer(stops);\n  }\n  \n  render2(type, index) {\n    const areas1 = this.data.tommorow.areas;\n    const areas2 = this.data.dayafter.areas;\n    const stops = [];\n\n    for (let code in areas1) {\n      const prefCode = areas1[code].area.prefCode;\n      const rank = this.getRank(areas2[prefCode], type, index);\n      if (rank) stops.push([code, this.getColor(rank)]);\n    }\n    this.renderLayer(stops);\n  }\n\n  renderAllType(type) {\n    const areas1 = this.data.tommorow.areas;\n    const areas2 = this.data.dayafter.areas;\n    const stops = [];\n\n    for (let code in areas1) {\n      const prefCode = areas1[code].area.prefCode;\n      const p1 = areas1[code].possibility.find(p => p.type === type) || {};\n      const p2 = areas2[prefCode].possibility.find(p => p.type === type) || {};\n      const rank = this.getMaxRank([].concat(p1.rank, p2.rank));\n      if (rank) stops.push([code, this.getColor(rank)]);\n    }\n    this.renderLayer(stops);\n\n  }\n\n  getRank(area, type, index) {\n    if (type === 'all') {\n      return area.possibilityAll[index];\n\n    } else {\n      const p = area.possibility.find(p => p.type === type);\n      return p ? p.rank[index] : undefined;\n    }\n  }\n\n  renderLayer(stops) {\n    const fill = stops.length ? {\n      \"property\": \"code\",\n      \"type\": \"categorical\",\n      \"stops\": stops,\n      \"default\": \"rgba(0, 0, 0, 0)\"\n    } : 'rgba(0, 0, 0, 0)';\n\n    if (!this.added) {\n      this.map.addLayer({\n        \"id\": \"possibility\",\n        \"type\": \"fill\",\n        \"source\": \"vt\",\n        \"source-layer\": \"distlict\",\n        \"paint\": {\n          \"fill-color\": fill,\n          \"fill-outline-color\": \"rgba(55, 55, 55, 0.4)\"\n        }\n      }, 'pref-line');\n      this.added = true;\n    } else {\n      this.map.setPaintProperty('possibility', 'fill-color', fill);\n    }\n  }\n\n\n  getColor(rank) {\n    const colors = {\n      '高': 'rgba(253, 108, 112, 0.5)',\n      '中':  'rgba(253, 188, 172, 0.4)'\n    };\n    return colors[rank];\n  }\n\n  getMaxRank(ranks) {\n    if (ranks.includes('高')) return '高'; \n    if (ranks.includes('中')) return '中';\n    return null;\n  }\n\n  hover = (e) => {\n    const features = this.map.queryRenderedFeatures(e.point, { layers: ['possibility'] });\n    this.map.getCanvas().style.cursor = (features.length) ? 'crosshair' : '';\n\n    let html;\n    if (features.length) {\n      console.log(features[0]);\n      const code = features[0].properties.code; \n      const info = this.data.tommorow.areas[code];\n      if (info) {\n        html = info.text;\n      }\n    }\n    \n    if (html) {\n      this.popup.setLngLat(e.lngLat)\n        .setHTML(html)\n        .addTo(this.map);\n    } else {\n      this.popup.remove();\n    }\n  }\n  \n}\n","import React, { Component } from 'react';\n\n//import Sidebar from './Sidebar';\nimport SelectButton from './components/SelectButton';\nimport TypeDropdown from './components/TypeDropdown';\nimport PossibilityLayer from './PossibilityLayer';\n\nconst url = 'https://storage.googleapis.com/weather-warning/possibility.json';\n\nexport default class Possibility extends Component {\n  state = {\n    data: null,\n  };\n\n  componentDidMount() {\n    this.loadWeatherInfo();\n  }\n\n  onload(map) {\n    this.map = map;\n    this.addLayer();\n  }\n  \n  loadWeatherInfo() {\n    const timestamp = new Date().getTime();\n    fetch(url + '?' + timestamp, {mode: 'cors'})\n      .then(res => res.json())\n      .then(data => {\n        console.log(data);\n        this.setState({ data });\n        this.data = data;\n        this.addLayer();\n      });\n  }\n\n  addLayer() {\n    if (!this.map || !this.data) return;\n    this.layer = new PossibilityLayer(this.map, this.data, this.onSelected);\n  }\n\n  render() {\n    return <>\n      <SelectButton\n        data={this.state.data}\n        onSelect={this.onSelectDatetime} />\n      <TypeDropdown\n        onSelect={this.onSelectType} />\n    </>;\n    /*\n    return (\n      <Sidebar\n        data={this.state.info}\n        ref={el => this.sidebar = el}\n      />\n    );\n    */\n  }\n\n  onSelectDatetime = (index) => {\n    this.layer.selectDatetime(index);\n  }\n\n  onSelectType = (type) => {\n    this.layer.selectType(type);\n  }\n}\n","import React, { Component } from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport 'mapbox-gl/dist/mapbox-gl.css'\n\n//import Warning from './Warning';\nimport Possibility from './Possibility';\nimport './Map.css';\n\nmapboxgl.accessToken = 'pk.eyJ1IjoidGF0dGlpIiwiYSI6ImNqZWZ4eWM3NTI2cGszM2xpYXEyZndpd3IifQ.ifzbR45HecVGxChbdR2hiw';\n\n\nexport default class Map extends Component {\n  componentDidMount() {\n    this.map = new mapboxgl.Map({\n      container: this.mapContainer,\n      style: 'mapbox://styles/tattii/cj1bob6hw003t2rr5s2svi3iq',\n      zoom: 4.2,\n      center: [136.6 + 10, 35.5],\n      hash: true,\n      attributionControl: false\n    });\n\n    this.map.on('load', () => {\n      this.child.onload(this.map);\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"app\">\n        <div ref={el => this.mapContainer = el} id=\"map\" />\n        <Possibility\n          ref={ref => this.child = ref}\n        />\n      </div>\n    )\n  }\n}\n","import React, { Component } from 'react';\n\nimport Map from './Map';\n\nclass App extends Component {\n  render() {\n    return (\n      <Map />\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('app'));\n\n"],"sourceRoot":""}
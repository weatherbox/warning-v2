{"version":3,"sources":["components/SelectButton.js","SelectedLayer.js","PossibilityLayer.js","Warning.js","Map.js","App.js","index.js"],"names":["SelectButton","state","times","selected","prevProps","this","props","data","getTimes","setState","_this2","react_default","a","createElement","Button","Group","inverted","className","map","time","i","size","key","onClick","onSelect","active","_this3","tommorow","timeDefine","forEach","def","text","pt","push","dayafter","Date","datetime","getDate","hours","parseInt","duration","substr","replace","from","toH","getTime","getHours","concat","Component","SelectedLayer","onSelected","_this","Object","classCallCheck","addSelectedLayer","on","e","_addSelectedLayer","type","addLayer","id","source","source-layer","paint","line-color","line-width","filter","features","console","log","properties","_this$getCode","getCode","code","prefName","name","selectPref","codes","l","setFilter","toConsumableArray","PossibilityLayer","hover","queryRenderedFeatures","point","layers","getCanvas","style","cursor","length","weatherInfo","prefs","popup","remove","addSource","minzoom","maxzoom","tiles","renderAll","selectedLayer","mapboxgl","Popup","closeButton","index","length1","render1","render2","stops","all","rank","getColor","renderLayer","areas","possibilityAll","areas1","areas2","area","prefCode","fill","property","default","added","setPaintProperty","fill-color","fill-outline-color","高","中","WeatherInfo","onSelectDatetime","layer","selectDatetime","loadWeatherInfo","timestamp","fetch","url","mode","then","res","json","SelectButton_SelectButton","accessToken","Map","container","mapContainer","zoom","center","hash","attributionControl","child","onload","ref","el","Warning_WeatherInfo","App","Map_Map","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.934ae083.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { Button } from 'semantic-ui-react';\n\nimport './SelectButton.css';\n\nexport default class SelectButton extends Component {\n  state = { times: null, selected: 0 };\n\n  componentDidUpdate(prevProps) {\n    if (this.props.data != prevProps.data) {\n      const times = this.getTimes();\n      this.setState({ times });\n    }\n  }\n\n  render() {\n    if (!this.state.times) return null;\n    return (\n      <Button.Group inverted className=\"select-button\">\n        {this.state.times.map((time, i) => (\n          <Button\n            inverted size=\"small\"\n            key={i}\n            onClick={() => this.onSelect(i)}\n            active={i === this.state.selected}\n          >\n            {time}\n          </Button>\n        ))}:\n      </Button.Group>\n    );\n  }\n\n  onSelect(i) {\n    this.setState({ selected: i });\n    this.props.onSelect(i);\n  }\n\n  getTimes() {\n    const times = ['すべて'];\n\n    this.props.data.tommorow.timeDefine.forEach(def => {\n      const text = this.pt(def);\n      times.push(text);\n    });\n\n    this.props.data.dayafter.timeDefine.forEach(def => {\n      times.push(new Date(def.datetime).getDate() + '日');\n    });\n\n    return times;\n  }\n\n  pt(def) {\n    const hours = parseInt(def.duration.substr(2).replace('H', ''));\n    const from = new Date(def.datetime);\n    const to = new Date(from.getTime() + hours * 3600 * 1000);\n    const toH = to.getHours() || 24;\n    return `${from.getDate()}日${from.getHours()}-${toH}`;\n  }\n}\n","export default class SelectedLayer {\n  constructor(map, onSelected) {\n    this.map = map;\n    this.onSelected = onSelected;\n\n    this.addSelectedLayer();\n    this.map.on('click', 'weather-info-pref', (e) => {\n      this.onClick(e);\n    });\n  }\n\n  addSelectedLayer() {\n    this._addSelectedLayer('pref');\n    this._addSelectedLayer('distlict');\n  }\n  \n  _addSelectedLayer(type) {\n    this.map.addLayer({\n      \"id\": type + \"-line-selected\",\n      \"type\": \"line\",\n      \"source\": \"vt\",\n      \"source-layer\": type,\n      \"paint\": {\n        \"line-color\": \"rgba(70, 171, 199, 0.8)\",\n        \"line-width\": 1\n      },\n      filter: [\"==\", \"code\", \"0\"]\n    });\n  }\n\n  onClick(e) {\n    if (e.features) {\n      console.log(e.features[0].properties);\n      const { code, name } = this.getCode(e.features[0].properties.code);\n      const prefName = name || e.features[0].properties.name;\n      this.selectPref(code);\n      this.onSelected(code, prefName);\n    }\n  }\n  \n  select(type, codes) {\n    ['pref', 'distlict', 'region'].forEach(l => {\n      const filter = l === type ? codes : ['0'];\n      this.map.setFilter(l + '-line-selected', ['in', 'code', ...filter]);\n    });\n  }\n}\n","import mapboxgl from 'mapbox-gl';\nimport SelectedLayer from './SelectedLayer';\n\n\nexport default class PossibilityLayer {\n  constructor(map, data, onSelected) {\n    this.map = map;\n    this.data = data;\n\n    this.map.addSource(\"vt\", {\n      \"type\": \"vector\",\n      \"minzoom\": 0,\n      \"maxzoom\": 10,\n      \"tiles\": [\"https://weatherbox.github.io/warning-area-vt/v2/{z}/{x}/{y}.pbf\"]\n    });\n\n    this.map.addLayer({\n      \"id\": \"pref-line\",\n      \"type\": \"line\",\n      \"source\": \"vt\",\n      \"source-layer\": \"pref\",\n      \"paint\": {\n        \"line-color\": \"rgba(70, 70, 70, 0.4)\"\n      }\n    });\n    this.renderAll();\n    this.selectedLayer =  new SelectedLayer(map, onSelected);\n\n    this.popup = new mapboxgl.Popup({\n      closeButton: false\n    });\n    this.map.on('mousemove', this.hover);\n  }\n\n  selectDatetime(index) {\n    const length1 = this.data.tommorow.timeDefine.length;\n    if (index === 0) {\n      this.renderAll();\n\n    } else if (index <= length1) {\n      this.render1(index - 1);\n    } else {\n      this.render2(index - length1 - 1);\n    }\n  }\n\n  renderAll() {\n    const stops = [];\n\n    for (let code in this.data.all) {\n      const rank = this.data.all[code];\n      if (rank) stops.push([code, this.getColor(rank)]);\n    }\n    this.renderLayer(stops);\n  }\n\n  render1(index) {\n    const areas = this.data.tommorow.areas;\n    const stops = [];\n\n    for (let code in areas) {\n      const rank = areas[code].possibilityAll[index];\n      if (rank) stops.push([code, this.getColor(rank)]);\n    }\n    this.renderLayer(stops);\n  }\n  \n  render2(index) {\n    const areas1 = this.data.tommorow.areas;\n    const areas2 = this.data.dayafter.areas;\n    const stops = [];\n\n    for (let code in areas1) {\n      const prefCode = areas1[code].area.prefCode;\n      const rank = areas2[prefCode].possibilityAll[index];\n      if (rank) stops.push([code, this.getColor(rank)]);\n    }\n    this.renderLayer(stops);\n  }\n\n  renderLayer(stops) {\n    const fill = stops.length ? {\n      \"property\": \"code\",\n      \"type\": \"categorical\",\n      \"stops\": stops,\n      \"default\": \"rgba(0, 0, 0, 0)\"\n    } : null;\n\n    if (!this.added) {\n      this.map.addLayer({\n        \"id\": \"possibility\",\n        \"type\": \"fill\",\n        \"source\": \"vt\",\n        \"source-layer\": \"distlict\",\n        \"paint\": {\n          \"fill-color\": fill,\n          \"fill-outline-color\": \"rgba(55, 55, 55, 0.4)\"\n        }\n      }, 'pref-line');\n      this.added = true;\n    } else {\n      this.map.setPaintProperty('possibility', 'fill-color', fill);\n    }\n  }\n\n\n  getColor(rank) {\n    const colors = {\n      '高': 'rgba(253, 108, 112, 0.5)',\n      '中':  'rgba(253, 188, 172, 0.4)'\n    };\n    return colors[rank];\n  }\n\n  hover = (e) => {\n    const features = this.map.queryRenderedFeatures(e.point, { layers: [] });\n    this.map.getCanvas().style.cursor = (features.length) ? 'crosshair' : '';\n\n    let html;\n    if (features.length) {\n      const code = this.getCode(features[0].properties.code);\n      const infos = this.weatherInfo.prefs[code];\n      if (infos) {\n      }\n    }\n    \n    if (html) {\n      this.popup.setLngLat(e.lngLat)\n        .setHTML(html)\n        .addTo(this.map);\n    } else {\n      this.popup.remove();\n    }\n  }\n  \n}\n","import React, { Component } from 'react';\n\n//import Sidebar from './Sidebar';\nimport SelectButton from './components/SelectButton';\nimport PossibilityLayer from './PossibilityLayer';\n\nconst url = 'https://storage.googleapis.com/weather-warning/possibility.json';\n\nexport default class WeatherInfo extends Component {\n  state = {\n    data: null,\n  };\n\n  componentDidMount() {\n    this.loadWeatherInfo();\n  }\n\n  onload(map) {\n    this.map = map;\n    this.addLayer();\n  }\n  \n  loadWeatherInfo() {\n    const timestamp = new Date().getTime();\n    fetch(url + '?' + timestamp, {mode: 'cors'})\n      .then(res => res.json())\n      .then(data => {\n        console.log(data);\n        this.setState({ data });\n        this.data = data;\n        this.addLayer();\n      });\n  }\n\n  addLayer() {\n    if (!this.map || !this.data) return;\n    this.layer = new PossibilityLayer(this.map, this.data, this.onSelected);\n  }\n\n  render() {\n    return <SelectButton\n      data={this.state.data}\n      onSelect={this.onSelectDatetime} />;\n    /*\n    return (\n      <Sidebar\n        data={this.state.info}\n        ref={el => this.sidebar = el}\n      />\n    );\n    */\n  }\n\n  onSelectDatetime = (index) => {\n    this.layer.selectDatetime(index);\n  }\n}\n","import React, { Component } from 'react';\nimport mapboxgl from 'mapbox-gl';\nimport 'mapbox-gl/dist/mapbox-gl.css'\n\nimport Warning from './Warning';\nimport './Map.css';\n\nmapboxgl.accessToken = 'pk.eyJ1IjoidGF0dGlpIiwiYSI6ImNqZWZ4eWM3NTI2cGszM2xpYXEyZndpd3IifQ.ifzbR45HecVGxChbdR2hiw';\n\n\nexport default class Map extends Component {\n  componentDidMount() {\n    this.map = new mapboxgl.Map({\n      container: this.mapContainer,\n      style: 'mapbox://styles/tattii/cj1bob6hw003t2rr5s2svi3iq',\n      zoom: 4.2,\n      center: [136.6 + 10, 35.5],\n      hash: true,\n      attributionControl: false\n    });\n\n    this.map.on('load', () => {\n      this.child.onload(this.map);\n    });\n  }\n\n  render() {\n    return (\n      <div className=\"app\">\n        <div ref={el => this.mapContainer = el} id=\"map\" />\n        <Warning\n          ref={ref => this.child = ref}\n        />\n      </div>\n    )\n  }\n}\n","import React, { Component } from 'react';\n\nimport Map from './Map';\n\nclass App extends Component {\n  render() {\n    return (\n      <Map />\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('app'));\n\n"],"sourceRoot":""}